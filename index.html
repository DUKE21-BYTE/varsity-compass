<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Varsity Compass | Engineer Your Future</title>
    <meta name="description" content="Varsity Compass provides expert guidance for Kenyan students on KUCCPS placement, HEF funding, and university transitions. Book a session or use our predictor tool today.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <img src="images/logo.png" alt="Varsity Compass Logo" style="height: 70px;">
            </div>
            
            <button class="mobile-toggle" aria-label="Toggle Navigation">
                <i class="fas fa-bars"></i>
            </button>

            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="predictor.html">Predictor Tool</a></li>
                <li><a href="#founder">About</a></li>
                <li><a href="https://wa.me/254746558597?text=I%20want%20to%20book%20a%20session%20for%20application%20support" class="btn-nav" style="background: var(--accent-green); color: white !important; border-color: var(--accent-green);">Book a Session</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="hero" class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1> Navigating your future<br><span class="highlight">together.</span></h1>
                <p class="hero-sub">
                    No login required. book a session for a proffesional guidance through the application process.
                </p>
                <div class="hero-buttons">
                    <a href="predictor.html" class="btn btn-primary">Start Calculator</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Trust Signals Bar -->
    <section class="trust-bar">
        <div class="container trust-grid">
            <div class="trust-item">
                <span class="trust-icon">üìä</span>
                <span>3+ Years of Data Analysis</span>
            </div>
            <div class="trust-item">
                <span class="trust-icon">‚úÖ</span>
                <span>100% HEF Portal Mastery</span>
            </div>
            <div class="trust-item">
                <span class="trust-icon">‚≠ê</span>
                <span>Trusted by 500+ Students</span>
            </div>
        </div>
    </section>

    <!-- News / Updates Section (Admin Editable) -->
    <section id="updates" class="news-section">
        <div class="container">
            <h2 class="section-title">Latest Updates</h2>
            <p class="section-sub">Stay informed with our latest announcements and schedules.</p>
            
            <!-- Hidden Inputs for Uploads -->
            <input type="file" id="news-upload-1" accept="image/*" style="display: none;">
            <input type="file" id="news-upload-2" accept="image/*" style="display: none;">

            <div class="news-grid">
                <!-- Slot 1 -->
                <div class="news-card">
                    <img id="news-img-1" src="" alt="Update 1" style="display: none;">
                    <div id="news-placeholder-1" class="news-placeholder">
                        <i class="fas fa-newspaper" style="font-size: 2rem; margin-bottom: 0.5rem;"></i><br>
                        News Slot 1
                    </div>
                    <div id="news-overlay-1" class="news-overlay">
                        <i class="fas fa-camera"></i> Upload Image
                    </div>
                    <button id="news-delete-1" class="news-delete" title="Remove Image"><i class="fas fa-trash"></i></button>
                </div>

                <!-- Slot 2 -->
                <div class="news-card">
                    <img id="news-img-2" src="" alt="Update 2" style="display: none;">
                    <div id="news-placeholder-2" class="news-placeholder">
                        <i class="fas fa-newspaper" style="font-size: 2rem; margin-bottom: 0.5rem;"></i><br>
                        News Slot 2
                    </div>
                    <div id="news-overlay-2" class="news-overlay">
                        <i class="fas fa-camera"></i> Upload Image
                    </div>
                    <button id="news-delete-2" class="news-delete" title="Remove Image"><i class="fas fa-trash"></i></button>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services-section">
        <div class="container">
            <h2 class="section-title">Our Service Pillars</h2>
            <p class="section-sub">End-to-end guidance for the Kenyan education landscape.</p>
            
            <div class="service-grid">
                <!-- Pillar 1: Mentorship -->
                <div class="service-card pillar-card">
                    <div class="icon">üó£Ô∏è</div>
                    <h3>Academic Mentorship</h3>
                    <p>Guidance to ignite passion and navigate academic challenges.</p>
                    <ul class="service-list">
                        <li>One-on-One Personalized Coaching</li>
                        <li>Group & School Motivational Talks</li>
                        <li>Career Pathway Planning</li>
                    </ul>
                    <a href="https://wa.me/254746558597?text=I%20want%20to%20book%20a%20session%20for%20Academic%20Mentorship" target="_blank" class="btn btn-outline" style="border-color: var(--primary-blue); color: var(--primary-blue); width: 100%; display: block; text-align: center;">Book Session</a>
                </div>

                <!-- Pillar 2: Placement -->
                <div class="service-card pillar-card">
                    <div class="icon">üéì</div>
                    <h3>KUCCPS Placement</h3>
                    <p>Strategic selection to guarantee university admission.</p>
                    <ul class="service-list">
                        <li>First-Time Course Selection</li>
                        <li>Revision of Choices Support</li>
                        <li>Inter-Institutional Transfers</li>
                        <li>JSS & Form 4 Pathway Consulting</li>
                    </ul>
                    <a href="https://wa.me/254746558597?text=I%20want%20to%20book%20a%20session%20for%20KUCCPS%20Placement" target="_blank" class="btn btn-outline" style="border-color: var(--primary-blue); color: var(--primary-blue); width: 100%; display: block; text-align: center;">Book Session</a>
                </div>

                <!-- Pillar 3: Funding -->
                <div class="service-card pillar-card">
                    <div class="icon">üí∞</div>
                    <h3>HEF & Funding</h3>
                    <p>Maximizing your scholarship and loan allocations.</p>
                    <ul class="service-list">
                        <li>New Funding Model Analysis</li>
                        <li>Application & Data Entry Support</li>
                        <li><strong>Band Error Rectification</strong></li>
                        <li>Funding Appeals Assistance</li>
                    </ul>
                    <a href="https://wa.me/254746558597?text=I%20want%20to%20book%20a%20session%20for%20HEF%20Funding" target="_blank" class="btn btn-outline" style="border-color: var(--primary-blue); color: var(--primary-blue); width: 100%; display: block; text-align: center;">Book Session</a>
                </div>

                <!-- Pillar 4: Transition -->
                <div class="service-card pillar-card">
                    <div class="icon">üè†</div>
                    <h3>Campus Transition</h3>
                    <p>Ensuring a smooth start to your university life.</p>
                    <ul class="service-list">
                        <li>Admissions & Registration Help</li>
                        <li>Hostel & "House Hunting" Support</li>
                        <li>Freshers' Financial Literacy</li>
                    </ul>
                    <a href="https://wa.me/254746558597?text=I%20want%20to%20book%20a%20session%20for%20Campus%20Transition" target="_blank" class="btn btn-outline" style="border-color: var(--primary-blue); color: var(--primary-blue); width: 100%; display: block; text-align: center;">Book Session</a>
                </div>
            </div>
            
            <!-- Institutional Partnership Tag -->
            <div class="partnership-banner">
                <p>üè´ <strong>Institutions:</strong> Partner with us for Career Days & Student Expos.</p>
            </div>
        </div>
    </section>

    <!-- Founder Section -->
    <section id="founder" class="founder-section" style="position: relative;">
        <!-- Hidden File Input for Image Update -->
        <input type="file" id="founder-upload" accept="image/*" style="display: none;">
        
        <div class="container founder-content">
            <div class="founder-image" style="position: relative; cursor: pointer;" title="Click 'Edit Profile' below to change image">
                <img id="founder-img" src="images/founder_final_4.png" alt="Franklin Bett - Founder" style="border-radius: 50%; border: 4px solid var(--highlight-gold); width: 200px; height: 200px; object-fit: cover; object-position: top;">
                <div id="img-overlay" style="position: absolute; inset: 0; background: rgba(0,0,0,0.5); border-radius: 50%; display: none; align-items: center; justify-content: center; color: white;">
                    <i class="fas fa-camera"></i> Change
                </div>
            </div>
            <div class="founder-text">
                <h2 id="founder-name">Franklin Bett</h2>
                <p class="founder-role" id="founder-role">Data Analyst & Education Consultant</p>
                <div class="founder-bio" id="founder-bio">
                    <p>Navigating the transition from High School to University is the most critical step in a student's life. I founded Varsity Compass to replace anxiety with data-driven strategy.</p>
                    <p>From <strong>KUCCPS placement math</strong> to solving <strong>HEF funding errors</strong>, my mission is simple: To ensure every Kenyan student gets the course they deserve and the funding they need.</p>
                </div>
                <div class="founder-actions">
                    <a href="https://wa.me/254746558597" class="btn btn-outline" style="border-color: #0D47A1; color: #0D47A1; margin-top: 1.5rem; display: inline-block; padding: 0.8rem 2rem;">Chat with Franklin</a>
                    <button id="edit-profile-btn" class="btn btn-outline" style="margin-top: 1.5rem; margin-left:10px; border-color: #555; color: #555; display: none;">‚úèÔ∏è Edit Profile</button>
                    <button id="save-profile-btn" class="btn btn-primary" style="margin-top: 1.5rem; margin-left:10px; display: none;">üíæ Save Changes</button>
                    <button id="change-pin-btn" class="btn btn-outline" style="margin-top: 1.5rem; margin-left:10px; border-color: #d32f2f; color: #d32f2f; display: none;">üîí Change PIN</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section class="reviews-section">
        <div class="container">
            <h3 class="reviews-header">What Students Say</h3>
            <div class="reviews-track">
                <!-- Set 1 -->
                <div class="review-card">
                    <p class="review-text">"I thought I'd miss out on university, but Franklin's strategy got me into my dream course!"</p>
                    <p class="review-author">- Brian K., UoN</p>
                </div>
                <div class="review-card">
                    <p class="review-text">"The funding error correction saved my parents. We were in Band 5, now Band 2."</p>
                    <p class="review-author">- Sarah M., KU</p>
                </div>
                <div class="review-card">
                    <p class="review-text">"Precise prediction. The calculator showed me exactly where I stood."</p>
                    <p class="review-author">- Emmanuel O., JKUAT</p>
                </div>
                <div class="review-card">
                    <p class="review-text">"Best advice for transfer students. Seamless process."</p>
                    <p class="review-author">- Joy W., Moi Uni</p>
                </div>
                 <!-- Set 2 (Duplicate for smooth loop) -->
                 <div class="review-card">
                    <p class="review-text">"I thought I'd miss out on university, but Franklin's strategy got me into my dream course!"</p>
                    <p class="review-author">- Brian K., UoN</p>
                </div>
                <div class="review-card">
                    <p class="review-text">"The funding error correction saved my parents. We were in Band 5, now Band 2."</p>
                    <p class="review-author">- Sarah M., KU</p>
                </div>
                <div class="review-card">
                    <p class="review-text">"Precise prediction. The calculator showed me exactly where I stood."</p>
                    <p class="review-author">- Emmanuel O., JKUAT</p>
                </div>
                <div class="review-card">
                    <p class="review-text">"Best advice for transfer students. Seamless process."</p>
                    <p class="review-author">- Joy W., Moi Uni</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <h3>Varsity Compass</h3>
                    <p>Your True North in Education.</p>
                </div>
                <div class="socials-list">
                    <a href="https://tiktok.com/@varsity.compass.ke" target="_blank" class="social-icon"><i class="fab fa-tiktok"></i></a>
                    <a href="https://youtube.com/@varsitycompasske" target="_blank" class="social-icon"><i class="fab fa-youtube"></i></a>
                    <a href="https://instagram.com/varsity.compasss.ke" target="_blank" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="https://facebook.com/profile.php?id=61587312115383" target="_blank" class="social-icon"><i class="fab fa-facebook"></i></a>
                    <a href="https://whatsapp.com/channel/0029VaqrCu07z4klGBuGtM47" target="_blank" class="social-icon"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
            <p class="copyright">&copy; 2026 Varsity Compass. All Rights Reserved.</p>
            <div style="margin-top: 10px; font-size: 0.8rem;">
                <a href="#" onclick="event.preventDefault(); enableAdminMode();" style="color: rgba(255,255,255,0.3); text-decoration: none;">Admin Login</a>
            </div>
        </div>
    </footer>

    <!-- Sticky Mobile Footer -->
    <div class="mobile-footer">
        <a href="https://wa.me/254746558597?text=I%20want%20to%20book%20a%20session" class="btn-whatsapp-full">Book a Session (WhatsApp)</a>
    </div>


    <script type="module">
        import { db, storage, doc, getDoc, setDoc, ref, uploadString, getDownloadURL, deleteObject } from './js/firebase_init.js';

        document.addEventListener('DOMContentLoaded', async () => {
            // --- Mobile Menu Logic ---
            const toggle = document.querySelector('.mobile-toggle');
            const navLinks = document.querySelector('.nav-links');
            if(toggle && navLinks) {
                toggle.addEventListener('click', () => {
                    navLinks.classList.toggle('active');
                    toggle.classList.toggle('active');
                });
            }

            // --- Elements ---
            const editBtn = document.getElementById('edit-profile-btn');
            const saveBtn = document.getElementById('save-profile-btn');
            const changePinBtn = document.getElementById('change-pin-btn');
            const fName = document.getElementById('founder-name');
            const fRole = document.getElementById('founder-role');
            const fBio  = document.getElementById('founder-bio');
            const fImg  = document.getElementById('founder-img');
            const fUpload = document.getElementById('founder-upload');
            const imgOverlay = document.getElementById('img-overlay');

            const news1Img = document.getElementById('news-img-1');
            const news2Img = document.getElementById('news-img-2');
            const news1Ph  = document.getElementById('news-placeholder-1');
            const news2Ph  = document.getElementById('news-placeholder-2');

            // --- Load Data from Firebase ---
            try {
                // Load Founder Profile
                const founderSnap = await getDoc(doc(db, "cms", "founder"));
                if (founderSnap.exists()) {
                    const data = founderSnap.data();
                    if(fName) fName.innerText = data.name || "Franklin Bett";
                    if(fRole) fRole.innerText = data.role || "Data Analyst & Education Consultant";
                    if(fBio) fBio.innerHTML = data.bio || fBio.innerHTML; // Fallback
                    if(fImg && data.imgUrl) fImg.src = data.imgUrl;
                }

                // Load News
                const newsSnap = await getDoc(doc(db, "cms", "news"));
                if (newsSnap.exists()) {
                    const data = newsSnap.data();
                    if(data.slot1) {
                        if(news1Img) { news1Img.src = data.slot1; news1Img.style.display = 'block'; }
                        if(news1Ph) news1Ph.style.display = 'none';
                    }
                    if(data.slot2) {
                        if(news2Img) { news2Img.src = data.slot2; news2Img.style.display = 'block'; }
                        if(news2Ph) news2Ph.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error("Error loading data:", error);
                // Fail gracefully often means simpler console log here
            }

            // --- Admin Mode Logic ---
            window.enableAdminMode = async function() {
                // 1. Get PIN from Firebase (or default to 1234 if not set)
                let storedPin = "1234";
                try {
                    const pinSnap = await getDoc(doc(db, "cms", "config"));
                    if(pinSnap.exists() && pinSnap.data().pin) {
                        storedPin = pinSnap.data().pin;
                    }
                } catch(e) {
                    console.log("Config not found, using default.");
                }

                const pass = prompt("Enter Admin PIN:", "");
                
                if(pass === storedPin) {
                    enableEditingUI();
                    alert("Admin Mode Enabled.");
                } else {
                    alert("Incorrect PIN.");
                }
            };

            function enableEditingUI() {
                if(editBtn) editBtn.style.display = 'inline-block';
                if(changePinBtn) changePinBtn.style.display = 'inline-block';
                
                // Allow Founder Edit
                if(editBtn) {
                    editBtn.onclick = () => {
                         // Explicitly re-select elements to be safe
                        const fName = document.getElementById('founder-name');
                        const fRole = document.getElementById('founder-role');
                        const fBio  = document.getElementById('founder-bio');
                        const fUpload = document.getElementById('founder-upload');
                        const imgOverlay = document.getElementById('img-overlay');

                        [fName, fRole, fBio].forEach(el => {
                            if(el) {
                                el.contentEditable = "true";
                                el.style.border = "1px dashed #ccc";
                                el.style.padding = "5px";
                            }
                        });
                        editBtn.style.display = 'none';
                        if(saveBtn) saveBtn.style.display = 'inline-block';
                        
                        if(imgOverlay) {
                            imgOverlay.style.display = 'flex';
                            imgOverlay.onclick = () => { if(fUpload) fUpload.click(); };
                        }
                    };
                }

                // Allow Founder Save
                if(saveBtn) {
                    saveBtn.onclick = async () => {
                        saveBtn.innerText = "Saving...";
                        try {
                            let imgUrl = fImg.src;
                            // Check if image is base64 (new upload)
                            if(imgUrl.startsWith('data:')) {
                                // Re-compress to be safe
                                // Note: We rely on the raw src if it's already set, 
                                // but ideally we should track the file. 
                                // For simplicity, we assume the user just selected a file 
                                // or we can re-compress the src if needed.
                                // Actually, let's just save the string. 
                                // Since we don't have the file object here easily unless we track it 
                                // globally, we trust the src is small enough OR we act smart:
                            }

                            await setDoc(doc(db, "cms", "founder"), {
                                name: fName.innerText,
                                role: fRole.innerText,
                                bio: fBio.innerHTML,
                                imgUrl: imgUrl
                            }, { merge: true });

                            // UI Reset
                            [fName, fRole, fBio].forEach(el => {
                                el.contentEditable = "false";
                                el.style.border = "none";
                                el.style.padding = "0";
                            });
                            saveBtn.style.display = 'none';
                            editBtn.style.display = 'inline-block';
                            if(imgOverlay) imgOverlay.style.display = 'none';
                            saveBtn.innerText = "üíæ Save Changes";
                            alert("Profile Saved to Database!");
                        } catch(e) {
                            console.error(e);
                            alert("Error saving profile: " + e.message);
                            saveBtn.innerText = "üíæ Save Changes";
                        }
                    };
                }

                // Allow PIN Change
                if(changePinBtn) {
                    changePinBtn.onclick = async () => {
                        const newPin = prompt("Enter new 4-digit PIN:", "");
                        if(newPin && newPin.length >= 4) {
                            await setDoc(doc(db, "cms", "config"), { pin: newPin }, { merge: true });
                            alert("PIN Updated Securely!");
                        }
                    };
                }

                // Allow News Uploads
                setupNewsUpload('news-upload-1', 'news-overlay-1', 'news-img-1', 'slot1');
                setupNewsUpload('news-upload-2', 'news-overlay-2', 'news-img-2', 'slot2');

                // Allow News Deletes
                document.getElementById('news-delete-1').style.display = 'flex';
                document.getElementById('news-delete-2').style.display = 'flex';
                
                setupNewsDelete('news-delete-1', 'news-img-1', 'news-placeholder-1', 'slot1');
                setupNewsDelete('news-delete-2', 'news-img-2', 'news-placeholder-2', 'slot2');
            }


            // Helper: Resize Image (To fit in Firestore directly)
            const resizeImage = (file, maxWidth) => {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;
                            
                            if (width > maxWidth) {
                                height *= maxWidth / width;
                                width = maxWidth;
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            // Compress to JPEG 0.7 quality
                            resolve(canvas.toDataURL('image/jpeg', 0.7)); 
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            };

            // Helper: News Upload (Using Firestore Storage)
            function setupNewsUpload(inputId, overlayId, imgId, slotKey) {
                const overlay = document.getElementById(overlayId);
                const input = document.getElementById(inputId);
                const img = document.getElementById(imgId);
                const phId = imgId.replace('img', 'placeholder');
                const ph = document.getElementById(phId);

                if(overlay) {
                    overlay.style.display = 'flex';
                    overlay.onclick = () => input.click();
                }

                if(input) {
                    input.onchange = async (e) => {
                        const file = e.target.files[0];
                        if(file) {
                            try {
                                alert("Compressing and Uploading...");
                                const base64String = await resizeImage(file, 800); // Max width 800px

                                // Show preview
                                img.src = base64String;
                                img.style.display = 'block';
                                if(ph) ph.style.display = 'none';

                                // Upload to Firestore directly
                                await setDoc(doc(db, "cms", "news"), {
                                    [slotKey]: base64String
                                }, { merge: true });
                                
                                alert("Poster Uploaded Successfully!");
                            } catch (e) {
                                console.error(e);
                                alert("Upload failed: " + e.message);
                            }
                        }
                    };
                }
            }


            // Helper: News Delete
            function setupNewsDelete(btnId, imgId, phId, slotKey) {
                const btn = document.getElementById(btnId);
                if(btn) {
                    btn.onclick = async (e) => {
                        e.stopPropagation();
                        if(confirm("Remove this poster?")) {
                            try {
                                const img = document.getElementById(imgId);
                                const ph = document.getElementById(phId);
                                
                                // UI Reset
                                if(img) { img.src = ""; img.style.display = 'none'; }
                                if(ph) ph.style.display = 'block';

                                // DB Update
                                // Firestore deleteField is cleaner, but setting to null works too
                                await setDoc(doc(db, "cms", "news"), {
                                    [slotKey]: ""
                                }, { merge: true });

                                alert("Removed!");
                            } catch(e) {
                                console.error(e);
                            }
                        }
                    };
                }
            }

            // Helper: Handle Founder Image Preview (Compress immediately)
            if(fUpload) {
                fUpload.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if(file) {
                        try {
                            const base64String = await resizeImage(file, 600); // 600px is enough for profile
                            fImg.src = base64String;
                        } catch(e) {
                            alert("Error processing image");
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
```
